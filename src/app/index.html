<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Học Liệu Lịch Sử Địa Phương - Nhân Vật Lịch Sử</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                    },
                    colors: {
                        'history-red': '#8B1E1E',
                        'history-gold': '#D4AF37',
                        'history-gold-light': '#F4E085',
                        'paper': '#FDFBF7',
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #FDFBF7; 
        }
        ::-webkit-scrollbar-thumb {
            background: #D4AF37; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #8B1E1E; 
        }

        .hero-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .card-hover {
            transition: all 0.3s ease;
        }
        /* Áp dụng hiệu ứng hover cho thẻ <a> */
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        /* Fade In Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Animation cho Loading Spinner (đã bị loại bỏ trong logic mới) */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin-custom {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-paper text-gray-800 font-sans antialiased selection:bg-history-gold selection:text-white">

    <nav class="fixed w-full z-50 bg-white/90 backdrop-blur-md border-b border-history-gold/30 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center cursor-pointer" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                    <div class="w-10 h-10 bg-history-red rounded-full flex items-center justify-center text-history-gold mr-3 shadow-md">
                        <i class="fa-solid fa-dragon text-xl"></i>
                    </div>
                    <span class="font-serif font-bold text-xl text-history-red tracking-wide">Học Liệu Lịch Sử Địa Phương</span>
                </div>

                <div class="hidden md:flex space-x-8">
                    <a href="#overview" class="text-gray-600 hover:text-history-red transition font-medium">Chương I: Khái Quát</a>
                    <a href="#gallery" data-chapter="2" onclick="setFilterAndScroll('Phong kiến');" class="text-gray-600 hover:text-history-red transition font-medium">Chương II: Phong Kiến</a>
                    <a href="#gallery" data-chapter="3" onclick="setFilterAndScroll('Hiện Đại');" class="text-gray-600 hover:text-history-red transition font-medium">Chương III: Hiện Đại</a>
                    <a href="#quiz" class="text-gray-600 hover:text-history-red transition font-medium">Chương IV: Luyện Tập Thêm</a>
                </div>

                <div class="flex items-center space-x-4">
                    <button class="md:hidden text-gray-600 text-2xl">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <header class="relative pt-24 pb-16 md:pt-32 md:pb-24 overflow-hidden hero-pattern">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
            <div class="inline-block mb-4 px-4 py-1 rounded-full bg-history-gold/20 text-history-red font-semibold text-sm tracking-wider uppercase border border-history-gold/30">
                Lịch sử địa phương tỉnh Quảng Trị
            </div>
            <h1 class="text-4xl md:text-6xl font-serif font-bold text-gray-900 mb-6 leading-tight">
                Kho tư liệu trực tuyến<br>
                <span class="text-history-red underline decoration-history-gold decoration-4 underline-offset-4">Lịch sử địa phương 12</span><br>
                <span class="text-history-red underline decoration-history-gold decoration-4 underline-offset-4">Chủ đề 2: Truyền thống văn hoá</span><br>
            </h1>
            <p class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto mb-10">
                Nhóm tác giả chúng tôi xin giới thiệu một học liệu tập trung vào các Nhân vật Tiêu biểu của tỉnh Quảng Trị như Nguyễn Hữu Dật, Lê Duẩn, Võ Nguyên Giáp. Đây không chỉ là một bộ sưu tập tiểu sử —đây là Phòng Thi Nghiệm Lịch Sử của riêng bạn. Chúng tôi xin cam kết mang lại cho độc giả những trải nghiệm tốt nhất về thông tin mang lại và độ tương tác sống động giúp bạn thích thú hơn và những lợi ích mang lại như nâng cao khả năng tự học, khả năng chọn lọc, cung cấp nguồn kiến thức cũng như rèn luyện lòng biết ơn cùng như tìm thấy nguồn cảm hứng để noi gương học tập theo, v.v
            </p>
            <p class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto mb-10">
                Khi bạn Khám phá những nhân vật lịch sử kiệt xuất sinh ra trên mảnh đất Quảng Trị, từ thời phong kiến đến các giai đoạn chống Pháp, chống Mỹ. Qua từng trang, bạn sẽ theo dòng chảy lịch sử theo thời gian, tìm hiểu về quê quán, tiểu sử và những đóng góp to lớn của những con người đã làm nên danh tiếng và truyền thống kiên cường của Quảng Trị. Khám phá lịch sử Quảng Trị – hiểu rõ quá khứ, trân trọng hiện tại và cảm nhận giá trị di sản vô giá của mảnh đất này!
            </p>
        </div>
        
        <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-white via-transparent to-transparent -z-10"></div>
    </header>

    <!-- Table of Contents Section -->
    <section class="bg-gradient-to-b from-history-gold/10 to-white py-12">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="bg-white rounded-2xl shadow-md border border-history-gold/30 p-8">
                <h2 class="text-3xl font-serif font-bold text-history-red mb-8 text-center">Mục Lục</h2>
                <div class="space-y-4">
                    <div class="border-b border-gray-200 pb-4">
                        <a href="#overview" class="flex items-center group hover:text-history-red transition">
                            <span class="text-history-gold font-bold mr-4 text-lg">I.</span>
                            <span class="font-semibold text-gray-800 group-hover:text-history-red">Khái Quát</span>
                            <i class="fa-solid fa-arrow-right ml-auto text-history-gold opacity-0 group-hover:opacity-100 transition"></i>
                        </a>
                    </div>
                    <div class="border-b border-gray-200 pb-4">
                        <a href="#gallery" onclick="setFilterAndScroll('Phong kiến');" class="flex items-center group hover:text-history-red transition">
                            <span class="text-history-gold font-bold mr-4 text-lg">II.</span>
                            <span class="font-semibold text-gray-800 group-hover:text-history-red">Một Số Nhân Vật Thời Phong Kiến</span>
                            <i class="fa-solid fa-arrow-right ml-auto text-history-gold opacity-0 group-hover:opacity-100 transition"></i>
                        </a>
                    </div>
                    <div class="border-b border-gray-200 pb-4">
                        <a href="#gallery" onclick="setFilterAndScroll('Hiện Đại');" class="flex items-center group hover:text-history-red transition">
                            <span class="text-history-gold font-bold mr-4 text-lg">III.</span>
                            <span class="font-semibold text-gray-800 group-hover:text-history-red">Một Số Nhân Vật Thời Hiện Đại</span>
                            <i class="fa-solid fa-arrow-right ml-auto text-history-gold opacity-0 group-hover:opacity-100 transition"></i>
                        </a>
                    </div>
                    <div class="pb-4">
                        <a href="#quiz" class="flex items-center group hover:text-history-red transition">
                            <span class="text-history-gold font-bold mr-4 text-lg">IV.</span>
                            <span class="font-semibold text-gray-800 group-hover:text-history-red">Luyện Tập Thêm</span>
                            <i class="fa-solid fa-arrow-right ml-auto text-history-gold opacity-0 group-hover:opacity-100 transition"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="overview" class="bg-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <div class="inline-block mb-4 px-4 py-1 rounded-full bg-history-gold/20 text-history-red font-semibold text-sm tracking-wider uppercase border border-history-gold/30">
                    Khái Quát Lịch Sử
                </div>
                <h2 class="text-4xl font-serif font-bold text-history-red mb-4">Nhân Vật Lịch Sử Quảng Trị</h2>
                <p class="text-gray-600 max-w-3xl mx-auto">
                    Tìm hiểu về những giai đoạn lịch sử hình thành nên mảnh đất Quảng Trị hào hùng
                </p>
            </div>

            <div class="space-y-12">
                <!-- Thời kỳ Phong kiến -->
                <div class="bg-paper rounded-2xl p-8 shadow-md border border-gray-100">
                    <h3 class="text-2xl font-serif font-bold text-gray-900 mb-4 flex items-center">
                        <span class="w-3 h-8 bg-history-gold rounded mr-3"></span>
                        Thời kỳ Phong kiến (Từ Hậu Trần đến triều Nguyễn)
                    </h3>
                    <div class="text-gray-700 leading-relaxed space-y-4 text-justify">
                        <p>
                            Vùng đất Quảng Bình và Quảng Trị là một phần của Thuận Hóa, từ lâu đã sản sinh ra những nhân vật có công khai sáng, kiến tạo và quản lý đất nước. Ngay từ thời kỳ Hậu Trần, vào cuối năm 1407, Đặng Tất đã khởi binh chống lại nhà Minh và được phong chức Quốc công. Đến thời Chúa Nguyễn và Triều Nguyễn, những nhân vật nổi bật về mặt trí tuệ và quản lý đã xuất hiện. Dương Văn An (Lệ Thủy, Quảng Bình) là Tiến sĩ và là tác giả của Ô Châu Cận Lục, một công trình địa lý học có giá trị lớn về vùng đất này. Về quản lý triều đình, các quan lại như Võ Xuân Cẩn và Nguyễn Đăng Giai (Quảng Bình) giữ những chức vụ quan trọng như Thượng thư, tham gia điều hành đất nước qua nhiều triều vua. Về học thuật và khoa học, Hiệp biện Đại học sĩ Nguyễn Hữu Thận (Triệu Phong, Quảng Trị) là nhân vật kiệt xuất, nổi tiếng là nhà toán pháp – lịch số, đồng thời là một nhà ngoại giao tài giỏi. Các quan lại khác ở Quảng Trị như Trần Đình Ân, Trần Đình Khánh cũng là những người có tiếng về chính sự và tài năng văn học.
                        </p>
                    </div>
                </div>

                <!-- Phong trào Kháng chiến và Cận đại -->
                <div class="bg-paper rounded-2xl p-8 shadow-md border border-gray-100">
                    <h3 class="text-2xl font-serif font-bold text-gray-900 mb-4 flex items-center">
                        <span class="w-3 h-8 bg-history-gold rounded mr-3"></span>
                        Phong trào Kháng chiến và Cận đại (Cuối Thế kỷ 19 - Đầu Thế kỷ 20)
                    </h3>
                    <div class="text-gray-700 leading-relaxed space-y-4 text-justify">
                        <p>
                            Khi thực dân Pháp xâm lược, tinh thần yêu nước của người dân hai tỉnh bùng cháy mạnh mẽ. Vùng đất Quảng Trị là nơi căn cứ Tân Sở được thiết lập làm "Kinh đô" kháng chiến và là nơi Dụ Cần vương của vua Hàm Nghi được ban bố. Các thủ lĩnh Cần Vương ở Quảng Bình như Nguyễn Phạm Tuân và Đoàn Chí Tuân (Bạch Xỉ) đã lãnh đạo nghĩa quân chiến đấu kiên cường, bảo vệ khu vực cửa ngõ phía Bắc kinh thành Huế. Ở Quảng Trị, các văn thân sĩ phu như Trương Đình Hội, Nguyễn Tự Như đã nhiệt tình hưởng ứng lời kêu gọi. Trong số các tướng lĩnh triều đình thuộc phe chủ chiến còn có Trần Xuân Hoà và Lâm Hoành (Quảng Trị) đã hết lòng vì nước. Đầu thế kỉ XX, những trí thức tân học, giàu lòng yêu nước ở Quảng Trị như Trần Cửu Cai, Lê Thế Vỹ, Khoá Bảo (Nguyễn Hữu Đồng) đã tích cực tham gia cuộc vận động Duy Tân và phong trào chống thuế Trung Kì.
                        </p>
                    </div>
                </div>

                <!-- Sự nghiệp Đấu tranh Cách mạng -->
                <div class="bg-paper rounded-2xl p-8 shadow-md border border-gray-100">
                    <h3 class="text-2xl font-serif font-bold text-gray-900 mb-4 flex items-center">
                        <span class="w-3 h-8 bg-history-gold rounded mr-3"></span>
                        Sự nghiệp Đấu tranh Cách mạng và Dựng xây Đất nước (Thế kỷ 20)
                    </h3>
                    <div class="text-gray-700 leading-relaxed space-y-4 text-justify">
                        <p>
                            Trong giai đoạn kháng chiến chống Pháp và chống Mỹ, Quảng Bình và Quảng Trị là cái nôi sản sinh ra những lãnh đạo quân sự và chính trị cấp cao của quốc gia. Nổi bật nhất là hai vị lãnh đạo vĩ đại. Đại tướng Võ Nguyên Giáp (Lệ Thủy, Quảng Bình) là Tổng Tư lệnh Quân đội Nhân dân Việt Nam, người có công lao to lớn trong việc chỉ đạo các chiến dịch quân sự, biến Quảng Bình và Vĩnh Linh (Quảng Trị) thành tuyến lửa anh hùng của cả nước. Tổng Bí thư Lê Duẩn (Triệu Phong, Quảng Trị) là nhà lãnh đạo kiệt xuất của Đảng Cộng sản Việt Nam, người đã đưa ra những quyết sách chiến lược quan trọng, định hướng cho sự nghiệp giải phóng và thống nhất đất nước. Bên cạnh đó, các nhà cách mạng tiền bối và tướng lĩnh khác như Trần Hữu Dực (nguyên Phó Thủ tướng), Đại tướng Đoàn Khuê (nguyên Bộ trưởng Bộ Quốc phòng), và Đặng Thí (nguyên Bộ trưởng) cũng đều là những người con ưu tú của Quảng Trị, đã hiến trọn đời mình cho sự nghiệp chung của dân tộc.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="sticky top-16 z-40 bg-paper/95 backdrop-blur border-b border-gray-200 py-3" id="gallery">
        <div class="max-w-7xl mx-auto px-4 overflow-x-auto">
            <div class="flex space-x-2 md:justify-center min-w-max" id="filterContainer">
                <button onclick="filterData('all')" class="filter-btn active px-5 py-2 rounded-full text-sm font-semibold transition bg-history-red text-white shadow-md" data-filter="all">Tất cả</button>
                <button onclick="filterData('Phong kiến')" class="filter-btn px-5 py-2 rounded-full text-sm font-semibold bg-white text-gray-600 border border-gray-200 hover:border-history-gold hover:text-history-gold transition" data-filter="Phong kiến">Thời kỳ Phong kiến</button>
                <button onclick="filterData('Hiện Đại')" class="filter-btn px-5 py-2 rounded-full text-sm font-semibold bg-white text-gray-600 border border-gray-200 hover:border-history-gold hover:text-history-gold transition" data-filter="Hiện Đại">Thời kỳ Hiện Đại</button>
            </div>
        </div>
    </section>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 min-h-screen">
        <div class="max-w-2xl mx-auto mb-12 relative">
            <input type="text" id="searchInput" placeholder="Tìm kiếm nhân vật (VD: Lê Duẩn)..." 
                class="w-full pl-12 pr-4 py-4 rounded-full border-2 border-gray-200 focus:border-history-gold focus:ring-2 focus:ring-history-gold/20 outline-none transition shadow-lg text-lg">
            <i class="fa-solid fa-magnifying-glass absolute left-5 top-1/2 -translate-y-1/2 text-gray-400 text-xl"></i>
        </div>

        <div id="characterGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
            <div id="initialLoader" class="col-span-full text-center py-10 text-gray-500">
                <i class="fa-solid fa-circle-notch fa-spin text-3xl text-history-gold"></i>
                <p class="mt-2">Đang tải dữ liệu lịch sử...</p>
            </div>
        </div>
        
        <div id="emptyState" class="hidden text-center py-20">
            <div class="inline-flex items-center justify-center w-20 h-20 bg-gray-100 rounded-full mb-4">
                <i class="fa-solid fa-scroll text-4xl text-gray-400"></i>
            </div>
            <h3 class="text-xl font-serif font-bold text-gray-700">Không tìm thấy nhân vật</h3>
            <p class="text-gray-500 mt-2">Hãy thử tìm kiếm từ khóa khác.</p>
        </div>
    </main>
    
    <section id="quiz" class="bg-paper py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <div class="inline-block mb-4 px-4 py-1 rounded-full bg-history-gold/20 text-history-red font-semibold text-sm tracking-wider uppercase border border-history-gold/30">
                    Học qua trò chơi
                </div>
                <h2 class="text-4xl font-serif font-bold text-history-red mb-4">Đố vui lịch sử</h2>
                <p class="text-gray-600 max-w-3xl mx-auto">
                    Thử thách kiến thức của bạn về các nhân vật lịch sử qua các trò chơi tương tác
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Game 1 -->
                <div class="bg-white rounded-2xl p-6 shadow-md border border-gray-100">
                    <h3 class="text-xl font-serif font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fa-solid fa-gamepad text-history-red mr-3"></i>
                        Trò chơi 1: Đây là ai
                    </h3>
                    <div class="rounded-xl overflow-hidden">
                        <iframe style="max-width:100%; width:100%; border-radius:12px;" src="https://wordwall.net/embed/900dde57dd9643548450c6fc081a0ab4?themeId=65&templateId=3&fontStackId=0" width="500" height="380" frameborder="0" allowfullscreen></iframe>
                    </div>
                </div>

                <!-- Game 2 -->
                <div class="bg-white rounded-2xl p-6 shadow-md border border-gray-100">
                    <h3 class="text-xl font-serif font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fa-solid fa-gamepad text-history-red mr-3"></i>
                        Trò chơi 2: Câu hỏi lịch sử
                    </h3>
                    <div class="rounded-xl overflow-hidden">
<iframe style="max-width:100%" src="https://wordwall.net/vi/embed/b4d71320bf31409bb4b8ad1b6c349eb8?themeId=59&templateId=30&fontStackId=0" width="500" height="380" frameborder="0" allowfullscreen></iframe>                    </div>
                </div>

                <!-- Game 3: Wayground Quiz -->
                <div class="bg-white rounded-2xl p-6 shadow-md border border-gray-100 flex flex-col">
                    <h3 class="text-xl font-serif font-bold text-gray-900 mb-4 flex items-center">
                        <i class="fa-solid fa-gamepad text-history-red mr-3"></i>
                        Trò chơi 3: Quiz tổng hợp
                    </h3>
                    <div class="rounded-xl overflow-hidden flex-1 min-h-[380px] flex">
                        <iframe src="https://wayground.com/embed/quiz/692330dde6cda288b6234dd2" title=" - Wayground" style="flex:1; min-height:380px; width:100%; border-radius:12px;" frameBorder="0" allowfullscreen></iframe>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer class="bg-gray-900 text-white py-12 border-t-4 border-history-gold">
        <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8">
            <div>
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 bg-history-gold rounded-full flex items-center justify-center text-gray-900 mr-2">
                        <i class="fa-solid fa-dragon"></i>
                    </div>
                    <span class="font-serif font-bold text-xl">Học Liệu Lịch Sử Địa Phương</span>
                </div>
                <p class="text-gray-400 text-sm leading-relaxed">
                    Trang web phục vụ mục đích giáo dục, giúp học sinh tiếp cận lịch sử một cách trực quan và sinh động nhất. Tự hào lịch sử Việt Nam.
                </p>
            </div>
            <div>
                <h4 class="font-bold text-lg mb-4 text-history-gold">Liên kết nhanh</h4>
                <ul class="space-y-2 text-gray-400 text-sm">
                    <li><a href="#" class="hover:text-white transition">Trang chủ</a></li>
                    <li><a href="#" class="hover:text-white transition">Thư viện ảnh</a></li>
                    <li><a href="#" class="hover:text-white transition">Tài liệu tham khảo</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-bold text-lg mb-4 text-history-gold">Liên hệ</h4>
                <p class="text-gray-400 text-sm mb-2"><i class="fa-solid fa-envelope mr-2"></i> contact@haokhiviethistory.vn</p>
                <div class="flex space-x-4 mt-4">
                    <a href="#" class="text-gray-400 hover:text-white transition text-xl"><i class="fa-brands fa-facebook"></i></a>
                    <a href="#" class="text-gray-400 hover:text-white transition text-xl"><i class="fa-brands fa-youtube"></i></a>
                </div>
            </div>
        </div>
        <div class="text-center border-t border-gray-800 mt-8 pt-8 text-gray-500 text-sm">
            &copy; 2023 Học Liệu Lịch Sử Địa Phương. Made for students.
        </div>
    </footer>

    <script>
        // --- Lấy dữ liệu từ FastAPI Backend ---
        // Tự động phát hiện môi trường:
        // - Production: Dùng /api (cùng domain với frontend qua Nginx reverse proxy)
        // - Development: Dùng http://localhost:8000
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:8000' 
            : 'http://140.245.117.24:8000';
        
        let figures = [];

        async function fetchFigures(callback) {
            const initialLoader = document.getElementById('initialLoader');
            initialLoader.classList.remove('hidden'); // Hiển thị loading
            
            try {
                const response = await fetch(`${API_BASE_URL}/figures`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                // Map API fields to frontend fields
                figures = data.map(figure => ({
                    id: figure.id,
                    name: figure.name,
                    title: figure.title || '',
                    era: figure.era || '',
                    desc: figure.introduction || '',
                    image: figure.image_intro || '',
                    birth_year: figure.birth_year,
                    death_year: figure.death_year,
                    fallbackColor: getFallbackColor(figure.era)
                }));
                
                callback && callback(figures);
            } catch (error) {
                console.error('Error fetching figures:', error);
                initialLoader.innerHTML = `
                    <div class="text-red-500">
                        <i class="fa-solid fa-exclamation-triangle text-3xl"></i>
                        <p class="mt-2">Không thể tải dữ liệu. Vui lòng kiểm tra kết nối API.</p>
                        <p class="text-sm mt-1">Lỗi: ${error.message}</p>
                    </div>
                `;
            } finally {
                initialLoader.classList.add('hidden'); // Ẩn loading khi hoàn tất
            }
        }

        function getFallbackColor(era) {
            if(era === 'Hiện đại') return 'bg-red-600';
            if(era === 'Phong kiến') return 'bg-yellow-700';
            if(era === 'Dựng nước') return 'bg-amber-700';
            if(era === 'Bắc thuộc') return 'bg-emerald-700';
            return 'bg-gray-400';
        }

        // --- Logic hiển thị ---
        const grid = document.getElementById('characterGrid');
        const searchInput = document.getElementById('searchInput');
        const emptyState = document.getElementById('emptyState');

        function renderCards(data) {
            grid.innerHTML = '';
            if (data.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            emptyState.classList.add('hidden');
            data.forEach(char => {
                let tagColor = 'bg-gray-100 text-gray-600';
                if(char.era === 'Hiện đại') tagColor = 'bg-red-100 text-red-700';
                if(char.era === 'Phong kiến') tagColor = 'bg-amber-100 text-amber-800';
                if(char.era === 'Dựng nước') tagColor = 'bg-emerald-100 text-emerald-800';
                
                // THAY ĐỔI: Sử dụng thẻ <a> thay vì <div> để tạo liên kết
                const card = document.createElement('a');
                
                // THAY ĐỔI: Thiết lập href trỏ đến trang detail.html với ID nhân vật
                card.href = `detail.html?id=${char.id}`; 
                
                // THAY ĐỔI: Bỏ cursor-pointer vì thẻ <a> đã ngầm hiểu là có thể click
                card.className = `bg-white rounded-2xl overflow-hidden shadow-sm border border-gray-100 card-hover flex flex-col h-full group animate-fade-in relative`; 
                
                // XÓA: Bỏ toàn bộ logic onclick và loading overlay (không cần thiết)

                // Helper: Lấy chữ cái đầu
                function getInitials(name) {
                    return name.split(' ').map(n => n[0]).join('').substring(0, 2);
                }

                // SỬA LỖI: Thêm dấu \ trước dấu ' trong chuỗi class để tránh lỗi cú pháp JS
                const imgHTML = `
                    <div class="h-56 w-full ${char.fallbackColor} relative overflow-hidden">
                        <img src="${char.image}" 
                             alt="${char.name}" 
                             class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                             onerror="this.style.display='none'; this.parentElement.innerHTML='<div class=\\'w-full h-full flex items-center justify-center text-white font-serif text-4xl font-bold opacity-50\\'>${getInitials(char.name)}</div>'">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-60"></div>
                        <div class="absolute bottom-3 left-4 text-white">
                            <p class="text-xs font-light opacity-90 uppercase tracking-wider">${char.title}</p>
                        </div>
                    </div>
                `;

                const contentHTML = `
                    <div class="p-6 flex flex-col flex-grow">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-xs font-bold px-2 py-1 rounded ${tagColor}">${char.era}</span>
                        </div>
                        <h3 class="text-xl font-serif font-bold text-gray-900 mb-2 group-hover:text-history-red transition">${char.name}</h3>
                        <p class="text-gray-500 text-sm line-clamp-3 mb-4 flex-grow">${char.desc}</p>
                        <button class="text-history-red font-semibold text-sm flex items-center mt-auto group-hover:translate-x-1 transition">
                            Xem chi tiết <i class="fa-solid fa-arrow-right ml-2 text-xs"></i>
                        </button>
                    </div>
                `;

                card.innerHTML = imgHTML + contentHTML;
                grid.appendChild(card);
            });
        }

        // --- Logic Lọc & Tìm kiếm ---
        let currentFilter = 'all';
        let activeChapter = null; // Track which chapter is active

        function setFilterAndScroll(category) {
            // Set the filter
            filterData(category);
            // Mark that a chapter filter was applied
            activeChapter = category;
            // Scroll to gallery section after a small delay to ensure filtering is applied
            setTimeout(() => {
                document.getElementById('gallery').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        }

        function filterData(category) {
            // Update buttons UI
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if(btn.dataset.filter === category) {
                    btn.classList.remove('bg-white', 'text-gray-600', 'border-gray-200');
                    btn.classList.add('bg-history-red', 'text-white', 'shadow-md', 'border-transparent');
                } else {
                    btn.classList.add('bg-white', 'text-gray-600', 'border-gray-200');
                    btn.classList.remove('bg-history-red', 'text-white', 'shadow-md', 'border-transparent');
                }
            });

            currentFilter = category;
            applyFilters();
        }

        searchInput.addEventListener('input', (e) => {
            applyFilters();
        });

        function applyFilters() {
            const query = searchInput.value.toLowerCase();
            
            const filtered = figures.filter(item => {
                const matchesCategory = currentFilter === 'all' || item.era === currentFilter || (currentFilter === 'Bắc thuộc' && item.era === 'Bắc thuộc') || (currentFilter === 'Dựng nước' && item.era === 'Dựng nước');
                const matchesSearch = item.name.toLowerCase().includes(query) || item.desc.toLowerCase().includes(query);
                return matchesCategory && matchesSearch;
            });

            renderCards(filtered);
        }

        // --- Init ---
        fetchFigures(() => {
            applyFilters();
        });

        // Highlight menu item when hash changes
        function updateMenuActive() {
          document.querySelectorAll('nav .md\\:flex a').forEach(a => {
            a.classList.remove('text-history-red', 'font-bold', 'border-b-2', 'border-history-red', 'transition');
            a.classList.add('text-gray-600', 'transition');
          });
          
          const hash = window.location.hash || '#overview';
          
          // Handle chapter-specific highlighting for gallery
          if(hash === '#gallery' && activeChapter) {
            // Find and highlight the correct chapter link
            document.querySelectorAll('nav .md\\:flex a[data-chapter]').forEach(a => {
              const chapter = a.getAttribute('data-chapter');
              if((chapter === '2' && activeChapter === 'Phong kiến') || 
                 (chapter === '3' && activeChapter === 'Hiện Đại')) {
                a.classList.add('text-history-red', 'font-bold', 'border-b-2', 'border-history-red', 'transition');
                a.classList.remove('text-gray-600');
              }
            });
          } else if(hash === '#gallery' && !activeChapter) {
            // If no activeChapter is set but hash is #gallery, don't highlight any chapter
            // This handles the case where we navigate directly to #gallery without a filter
          } else {
            // Normal hash-based highlighting for non-chapter links
            document.querySelectorAll('nav .md\\:flex a').forEach(a => {
              const href = a.getAttribute('href');
              if(href === hash) {
                a.classList.add('text-history-red', 'font-bold', 'border-b-2', 'border-history-red', 'transition');
                a.classList.remove('text-gray-600');
              }
            });
          }
        }
        window.addEventListener('hashchange', updateMenuActive);
        document.addEventListener('DOMContentLoaded', updateMenuActive);
        
        // Gỡ bỏ sự kiện đóng modal (không cần thiết)
        // document.addEventListener('keydown', (e) => {
        //     if (e.key === 'Escape') closeModal();
        // });
    </script>
</body>
</html>